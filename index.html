<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; padding: 16px; padding-bottom: 80px; }
        .header-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 24px; color: white; margin-bottom: 16px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
        .stat-item p:first-child { font-size: 14px; opacity: 0.9; margin-bottom: 4px; }
        .stat-item p:last-child { font-size: 28px; font-weight: bold; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn { padding: 20px; border-radius: 12px; border: none; color: white; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .btn-green { background: #10b981; }
        .btn-orange { background: #f59e0b; }
        .btn-blue { background: #3b82f6; }
        .btn-purple { background: #8b5cf6; }
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .back-btn, .save-btn { background: none; border: none; color: #3b82f6; font-size: 16px; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .save-btn { color: #10b981; }
        input[type="text"], input[type="date"], input[type="number"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .exercise-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f9f9f9; border-radius: 8px; margin-bottom: 8px; }
        .delete-btn { background: none; border: none; color: #ef4444; cursor: pointer; font-size: 20px; }
        .set-row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
        .set-label { font-weight: 600; width: 100px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { aspect-ratio: 1; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; border: none; }
        .day-empty { background: #f0f0f0; }
        .day-workout { background: #10b981; color: white; font-weight: bold; }
        .day-today { box-shadow: 0 0 0 2px #3b82f6; }
        .empty-state { text-align: center; padding: 40px 20px; color: #999; }
        .hide { display: none; }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div id="homeView"></div>
        <div id="exercisesView" class="hide"></div>
        <div id="newWorkoutView" class="hide"></div>
        <div id="calendarView" class="hide"></div>
        <div id="workoutDetailView" class="hide"></div>
        <div id="statsView" class="hide"></div>
        <div id="exerciseProgressView" class="hide"></div>
        <div id="exerciseDetailView" class="hide"></div>
        <div id="settingsView" class="hide"></div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let exercises = [];
        let workouts = [];
        let currentView = 'home';
        let selectedDate = new Date().toISOString().split('T')[0];
        let currentWorkout = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
            try {
                const ex = localStorage.getItem('workout-exercises');
                const wo = localStorage.getItem('workout-logs');
                if (ex) exercises = JSON.parse(ex);
                if (wo) workouts = JSON.parse(wo);
            } catch (e) {
                console.log('First load');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveExercises() {
            localStorage.setItem('workout-exercises', JSON.stringify(exercises));
        }

        function saveWorkouts() {
            localStorage.setItem('workout-logs', JSON.stringify(workouts));
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–æ–≤
        function showView(viewName) {
            document.querySelectorAll('[id$="View"]').forEach(v => v.classList.add('hide'));
            document.getElementById(viewName + 'View').classList.remove('hide');
            currentView = viewName;
            renderView(viewName);
        }

        // –†–∞—Å—á—ë—Ç —Å—Ç—Ä–∏–∫–∞
        function getCurrentStreak() {
            if (workouts.length === 0) return 0;
            const sorted = [...workouts].sort((a, b) => new Date(b.date) - new Date(a.date));
            let streak = 0;
            let current = new Date();
            current.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < 365; i++) {
                const dateStr = current.toISOString().split('T')[0];
                if (sorted.some(w => w.date === dateStr)) {
                    streak++;
                    current.setDate(current.getDate() - 1);
                } else if (i === 0) {
                    current.setDate(current.getDate() - 1);
                } else {
                    break;
                }
            }
            return streak;
        }

        function getTotalVolume() {
            return workouts.reduce((t, w) => t + w.exercises.reduce((e, ex) => e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);
        }

        // –†–µ–Ω–¥–µ—Ä –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function renderHome() {
            const streak = getCurrentStreak();
            const todayWorkout = workouts.find(w => w.date === selectedDate);
            
            let html = `
                <div class="header-card">
                    <h1 style="font-size: 24px; margin-bottom: 8px;">üí™ –¢—Ä–µ–∫–µ—Ä –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <p>–°—Ç—Ä–∏–∫ üî•</p>
                            <p>${streak} ${streak === 1 ? '–¥–µ–Ω—å' : streak < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'}</p>
                        </div>
                        <div class="stat-item">
                            <p>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                            <p>${workouts.length}</p>
                        </div>
                    </div>
                </div>
                
                <div class="btn-grid">
                    <button class="btn btn-green" onclick="showView('newWorkout')">
                        <span style="font-size: 32px;">‚ûï</span>
                        <span>–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
                    </button>
                    <button class="btn btn-orange" onclick="showView('exercises')">
                        <span style="font-size: 32px;">üèãÔ∏è</span>
                        <span>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</span>
                    </button>
                    <button class="btn btn-blue" onclick="showView('calendar')">
                        <span style="font-size: 32px;">üìÖ</span>
                        <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
                    </button>
                    <button class="btn btn-purple" onclick="showView('stats')">
                        <span style="font-size: 32px;">üìä</span>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </button>
                </div>
                <button class="btn btn-green" style="width: 100%; margin-top: 12px;" onclick="showView('exerciseProgress')">
                    <span style="font-size: 24px;">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
                </button>
                <button class="btn btn-blue" style="width: 100%; margin-top: 12px; background: #6b7280;" onclick="showView('settings')">
                    <span style="font-size: 20px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
            `;

            if (todayWorkout) {
                html += '<div class="card"><h3 style="margin-bottom: 12px;">–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h3>';
                todayWorkout.exercises.forEach(ex => {
                    const exercise = exercises.find(e => e.id === ex.exerciseId);
                    const type = exercise ? exercise.type : 'reps';
                    const total = ex.sets.reduce((s, set) => s + set.reps, 0);
                    
                    let display = '';
                    if (type === 'weight') {
                        const totalWeight = ex.sets.reduce((s, set) => s + (set.weight || 0) * set.reps, 0);
                        display = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${total} –ø–æ–≤—Ç ‚Ä¢ ${Math.round(totalWeight)} –∫–≥`;
                    } else if (type === 'distance') {
                        display = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${total.toFixed(1)} –∫–º`;
                    } else if (type === 'time') {
                        display = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${Math.round(total)} –º–∏–Ω`;
                    } else {
                        display = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${total} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π`;
                    }
                    
                    html += `<div style="padding: 8px 0; border-bottom: 1px solid #eee;">
                        <div style="font-weight: 600;">${ex.exerciseName}</div>
                        <div style="color: #666; font-size: 14px;">${display}</div>
                    </div>`;
                });
                html += '</div>';
            }

            document.getElementById('homeView').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function renderExercises() {
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
                    <div style="width: 60px;"></div>
                </div>
                <div class="card">
                    <input type="text" id="newExercise" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è" style="margin-bottom: 12px;">
                    <select id="exerciseType" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 12px;">
                        <option value="reps">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</option>
                        <option value="weight">–í–µ—Å + –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</option>
                        <option value="distance">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</option>
                        <option value="time">–í—Ä–µ–º—è (–º–∏–Ω)</option>
                    </select>
                    <button class="btn btn-green" style="width: 100%; padding: 12px;" onclick="addExercise()">–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
                </div>
            `;

            if (exercises.length === 0) {
                html += '<div class="empty-state"><div style="font-size: 48px;">üèãÔ∏è</div><p>–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p></div>';
            } else {
                exercises.forEach(ex => {
                    const typeLabel = ex.type === 'weight' ? 'üèãÔ∏è –í–µ—Å' : ex.type === 'distance' ? 'üö¥ –ö–º' : ex.type === 'time' ? '‚è±Ô∏è –í—Ä–µ–º—è' : 'üî¢ –ü–æ–≤—Ç';
                    html += `<div class="exercise-item">
                        <div>
                            <span style="font-weight: 600;">${ex.name}</span>
                            <div style="font-size: 12px; color: #666; margin-top: 2px;">${typeLabel}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteExercise('${ex.id}')">üóëÔ∏è</button>
                    </div>`;
                });
            }

            document.getElementById('exercisesView').innerHTML = html;
        }

        function addExercise() {
            const input = document.getElementById('newExercise');
            const typeSelect = document.getElementById('exerciseType');
            if (input.value.trim()) {
                exercises.push({
                    id: Date.now().toString(),
                    name: input.value.trim(),
                    type: typeSelect.value,
                    createdAt: new Date().toISOString()
                });
                saveExercises();
                renderExercises();
            }
        }

        function deleteExercise(id) {
            exercises = exercises.filter(e => e.id !== id);
            saveExercises();
            renderExercises();
        }

        // –†–µ–Ω–¥–µ—Ä –Ω–æ–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function renderNewWorkout() {
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h2>
                    <button class="save-btn" onclick="saveWorkoutData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚úì</button>
                </div>
                <div class="card">
                    <input type="date" id="workoutDate" value="${selectedDate}" onchange="selectedDate = this.value">
                </div>
            `;

            if (exercises.length === 0) {
                html += '<div class="empty-state"><p>–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</p><button class="btn btn-orange" style="margin-top: 16px;" onclick="showView(\'exercises\')">–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</button></div>';
            } else {
                html += '<div class="card"><h3 style="margin-bottom: 12px;">–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</h3>';
                exercises.forEach(ex => {
                    const typeLabel = ex.type === 'weight' ? 'üèãÔ∏è' : ex.type === 'distance' ? 'üö¥' : ex.type === 'time' ? '‚è±Ô∏è' : 'üî¢';
                    html += `<button class="btn btn-blue" style="width: 100%; margin-bottom: 8px; padding: 12px;" onclick="addSetToWorkout('${ex.id}')">${typeLabel} ${ex.name}</button>`;
                });
                html += '</div>';

                if (currentWorkout.length > 0) {
                    html += '<div id="currentWorkoutArea">';
                    currentWorkout.forEach(w => {
                        const exercise = exercises.find(e => e.id === w.exerciseId);
                        const type = exercise ? exercise.type : 'reps';
                        
                        html += `<div class="card">
                            <h4 style="margin-bottom: 12px;">${w.exerciseName}</h4>
                            <div id="sets-${w.exerciseId}">`;
                        
                        w.sets.forEach((set, idx) => {
                            html += `<div class="set-row">
                                <span class="set-label">–ü–æ–¥—Ö–æ–¥ ${set.setNumber}:</span>`;
                            
                            if (type === 'weight') {
                                html += `<input type="number" value="${set.weight || 0}" onchange="updateWeight('${w.exerciseId}', ${idx}, this.value)" placeholder="–í–µ—Å (–∫–≥)" style="flex: 0.5; margin-right: 4px;">
                                        <input type="number" value="${set.reps}" onchange="updateReps('${w.exerciseId}', ${idx}, this.value)" placeholder="–ü–æ–≤—Ç" style="flex: 0.5;">`;
                            } else if (type === 'distance') {
                                html += `<input type="number" step="0.1" value="${set.reps}" onchange="updateReps('${w.exerciseId}', ${idx}, this.value)" placeholder="–ö–º" style="flex: 1;">`;
                            } else if (type === 'time') {
                                html += `<input type="number" value="${set.reps}" onchange="updateReps('${w.exerciseId}', ${idx}, this.value)" placeholder="–ú–∏–Ω" style="flex: 1;">`;
                            } else {
                                html += `<input type="number" value="${set.reps}" onchange="updateReps('${w.exerciseId}', ${idx}, this.value)" placeholder="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è" style="flex: 1;">`;
                            }
                            
                            html += `<button class="delete-btn" onclick="removeSet('${w.exerciseId}', ${idx})">‚úï</button>
                            </div>`;
                        });
                        
                        html += `</div>
                            <button class="btn btn-green" style="width: 100%; padding: 10px; margin-top: 8px;" onclick="addSetToWorkout('${w.exerciseId}')">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
                        </div>`;
                    });
                    html += '</div>';
                }
            }

            document.getElementById('newWorkoutView').innerHTML = html;
        }

        function addSetToWorkout(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            if (!exercise) return;

            const existing = currentWorkout.find(w => w.exerciseId === exerciseId);
            if (existing) {
                existing.sets.push({ reps: 0, weight: 0, setNumber: existing.sets.length + 1 });
            } else {
                currentWorkout.push({
                    exerciseId,
                    exerciseName: exercise.name,
                    sets: [{ reps: 0, weight: 0, setNumber: 1 }]
                });
            }
            renderNewWorkout();
        }

        function updateReps(exerciseId, setIndex, reps) {
            const workout = currentWorkout.find(w => w.exerciseId === exerciseId);
            if (workout) {
                workout.sets[setIndex].reps = parseFloat(reps) || 0;
            }
        }

        function updateWeight(exerciseId, setIndex, weight) {
            const workout = currentWorkout.find(w => w.exerciseId === exerciseId);
            if (workout) {
                workout.sets[setIndex].weight = parseFloat(weight) || 0;
            }
        }

        function removeSet(exerciseId, setIndex) {
            const workout = currentWorkout.find(w => w.exerciseId === exerciseId);
            if (workout) {
                workout.sets.splice(setIndex, 1);
                workout.sets.forEach((s, i) => s.setNumber = i + 1);
                if (workout.sets.length === 0) {
                    currentWorkout = currentWorkout.filter(w => w.exerciseId !== exerciseId);
                }
                renderNewWorkout();
            }
        }

        function saveWorkoutData() {
            if (currentWorkout.length === 0) return;

            const workout = {
                id: Date.now().toString(),
                date: selectedDate,
                exercises: currentWorkout,
                timestamp: new Date().toISOString()
            };

            const idx = workouts.findIndex(w => w.date === selectedDate);
            if (idx >= 0) {
                workouts[idx] = workout;
            } else {
                workouts.push(workout);
            }

            saveWorkouts();
            currentWorkout = [];
            showView('home');
        }

        // –†–µ–Ω–¥–µ—Ä –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function renderCalendar() {
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
                    <div style="width: 60px;"></div>
                </div>
                <div class="card">
                    <div class="calendar-grid">
            `;

            const today = new Date();
            for (let i = 30; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                const hasWorkout = workouts.some(w => w.date === dateStr);
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                const classes = `calendar-day ${hasWorkout ? 'day-workout' : 'day-empty'} ${isToday ? 'day-today' : ''}`;
                
                html += `<button class="${classes}" onclick="viewWorkoutDetail('${dateStr}')">${date.getDate()}</button>`;
            }

            html += '</div></div>';
            document.getElementById('calendarView').innerHTML = html;
        }

        function viewWorkoutDetail(date) {
            const workout = workouts.find(w => w.date === date);
            if (!workout) return;

            selectedDate = date;
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('calendar')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>${new Date(date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' })}</h2>
                    <div style="width: 60px;"></div>
                </div>
            `;

            workout.exercises.forEach(ex => {
                const exercise = exercises.find(e => e.id === ex.exerciseId);
                const type = exercise ? exercise.type : 'reps';
                
                html += `<div class="card">
                    <h3 style="margin-bottom: 12px;">${ex.exerciseName}</h3>`;
                
                ex.sets.forEach(set => {
                    html += `<div style="display: flex; justify-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                        <span style="font-weight: 600;">–ü–æ–¥—Ö–æ–¥ ${set.setNumber}</span>
                        <span style="color: #666;">`;
                    
                    if (type === 'weight') {
                        html += `${set.weight || 0} –∫–≥ √ó ${set.reps} –ø–æ–≤—Ç`;
                    } else if (type === 'distance') {
                        html += `${set.reps} –∫–º`;
                    } else if (type === 'time') {
                        html += `${set.reps} –º–∏–Ω`;
                    } else {
                        html += `${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π`;
                    }
                    
                    html += `</span></div>`;
                });
                
                let summary = '';
                if (type === 'weight') {
                    const totalReps = ex.sets.reduce((s, set) => s + set.reps, 0);
                    const totalWeight = ex.sets.reduce((s, set) => s + (set.weight || 0) * set.reps, 0);
                    summary = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${totalReps} –ø–æ–≤—Ç ‚Ä¢ ${totalWeight} –∫–≥ –æ–±—â–∏–π`;
                } else if (type === 'distance') {
                    const totalDistance = ex.sets.reduce((s, set) => s + set.reps, 0);
                    summary = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${totalDistance} –∫–º –≤—Å–µ–≥–æ`;
                } else if (type === 'time') {
                    const totalTime = ex.sets.reduce((s, set) => s + set.reps, 0);
                    summary = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${totalTime} –º–∏–Ω –≤—Å–µ–≥–æ`;
                } else {
                    const totalReps = ex.sets.reduce((s, set) => s + set.reps, 0);
                    summary = `${ex.sets.length} –ø–æ–¥—Ö–æ–¥–æ–≤ ‚Ä¢ ${totalReps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π`;
                }
                
                html += `<div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid #eee; color: #666; font-size: 14px;">
                    –í—Å–µ–≥–æ: ${summary}
                </div></div>`;
            });

            document.getElementById('workoutDetailView').innerHTML = html;
            showView('workoutDetail');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function getWeeklyStats() {
            const today = new Date();
            const stats = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                const dayWorkout = workouts.find(w => w.date === dateStr);
                
                const totalReps = dayWorkout ? dayWorkout.exercises.reduce((total, ex) => 
                    total + ex.sets.reduce((s, set) => s + set.reps, 0), 0) : 0;

                stats.push({
                    day: date.toLocaleDateString('ru-RU', { weekday: 'short' }),
                    reps: totalReps
                });
            }
            return stats;
        }

        function getWeeklyProgress() {
            const today = new Date();
            const thisWeek = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000) && date <= today;
            });
            const lastWeek = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= new Date(today.getTime() - 13 * 24 * 60 * 60 * 1000) && 
                       date < new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            });

            const thisTotal = thisWeek.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);
            const lastTotal = lastWeek.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);

            const diff = thisTotal - lastTotal;
            const percent = lastTotal === 0 ? 0 : Math.round((diff / lastTotal) * 100);
            return { diff, percent, isPositive: diff >= 0 };
        }

        function getMonthlyStats() {
            const today = new Date();
            const stats = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                const dayWorkout = workouts.find(w => w.date === dateStr);
                
                const totalReps = dayWorkout ? dayWorkout.exercises.reduce((total, ex) => 
                    total + ex.sets.reduce((s, set) => s + set.reps, 0), 0) : 0;

                stats.push({
                    date: date.getDate(),
                    reps: totalReps
                });
            }
            return stats;
        }

        function getMonthlyProgress() {
            const today = new Date();
            const thisMonth = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= new Date(today.getTime() - 29 * 24 * 60 * 60 * 1000) && date <= today;
            });
            const lastMonth = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= new Date(today.getTime() - 59 * 24 * 60 * 60 * 1000) && 
                       date < new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            });

            const thisTotal = thisMonth.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);
            const lastTotal = lastMonth.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);

            const diff = thisTotal - lastTotal;
            const percent = lastTotal === 0 ? 0 : Math.round((diff / lastTotal) * 100);
            return { diff, percent, isPositive: diff >= 0 };
        }

        function getYearlyStats() {
            const today = new Date();
            const stats = [];
            
            for (let i = 11; i >= 0; i--) {
                const monthDate = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthStart = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
                const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
                
                const monthWorkouts = workouts.filter(w => {
                    const date = new Date(w.date);
                    return date >= monthStart && date <= monthEnd;
                });

                const totalReps = monthWorkouts.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                    e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);

                stats.push({
                    month: monthDate.toLocaleDateString('ru-RU', { month: 'short' }),
                    reps: totalReps
                });
            }
            return stats;
        }

        function getYearlyProgress() {
            const today = new Date();
            const sixMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 6, 1);
            const twelveMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 12, 1);
            
            const lastSix = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= sixMonthsAgo && date <= today;
            });
            const prevSix = workouts.filter(w => {
                const date = new Date(w.date);
                return date >= twelveMonthsAgo && date < sixMonthsAgo;
            });

            const lastTotal = lastSix.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);
            const prevTotal = prevSix.reduce((t, w) => t + w.exercises.reduce((e, ex) => 
                e + ex.sets.reduce((s, set) => s + set.reps, 0), 0), 0);

            const diff = lastTotal - prevTotal;
            const percent = prevTotal === 0 ? 0 : Math.round((diff / prevTotal) * 100);
            return { diff, percent, isPositive: diff >= 0 };
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞
        function drawBarChart(canvasId, data, color = '#3b82f6') {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.clearRect(0, 0, width, height);
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º—É–º
            const maxValue = Math.max(...data.map(d => d.reps), 1);
            const barWidth = chartWidth / data.length - 10;
            
            // –†–∏—Å—É–µ–º —Å—Ç–æ–ª–±—Ü—ã
            data.forEach((item, i) => {
                const barHeight = (item.reps / maxValue) * chartHeight;
                const x = padding + (chartWidth / data.length) * i + 5;
                const y = padding + chartHeight - barHeight;
                
                // –°—Ç–æ–ª–±–µ—Ü
                ctx.fillStyle = color;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // –ü–æ–¥–ø–∏—Å—å –≤–Ω–∏–∑—É
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(item.day || item.month || item.date, x + barWidth / 2, height - 15);
                
                // –ó–Ω–∞—á–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É
                if (item.reps > 0) {
                    ctx.fillStyle = '#333';
                    ctx.font = 'bold 11px Arial';
                    ctx.fillText(item.reps, x + barWidth / 2, y - 5);
                }
            });
        }

        function drawLineChart(canvasId, data, color = '#8b5cf6') {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            ctx.clearRect(0, 0, width, height);
            
            const maxValue = Math.max(...data.map(d => d.reps), 1);
            const stepX = chartWidth / (data.length - 1);
            
            // –†–∏—Å—É–µ–º –ª–∏–Ω–∏—é
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            
            data.forEach((item, i) => {
                const x = padding + stepX * i;
                const y = padding + chartHeight - (item.reps / maxValue) * chartHeight;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏
            data.forEach((item, i) => {
                const x = padding + stepX * i;
                const y = padding + chartHeight - (item.reps / maxValue) * chartHeight;
                
                ctx.beginPath();
                ctx.fillStyle = color;
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // –ü–æ–¥–ø–∏—Å–∏ (–∫–∞–∂–¥—É—é 5-—é)
                if (i % 5 === 0) {
                    ctx.fillStyle = '#666';
                    ctx.font = '11px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(item.date, x, height - 15);
                }
            });
        }

        // –†–µ–Ω–¥–µ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function renderStats() {
            const streak = getCurrentStreak();
            const volume = getTotalVolume();
            const totalSets = workouts.reduce((t, w) => t + w.exercises.reduce((e, ex) => e + ex.sets.length, 0), 0);
            const weeklyData = getWeeklyStats();
            const monthlyData = getMonthlyStats();
            const yearlyData = getYearlyStats();
            const weeklyProg = getWeeklyProgress();
            const monthlyProg = getMonthlyProgress();
            const yearlyProg = getYearlyProgress();

            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    <div style="width: 60px;"></div>
                </div>
                <div class="header-card">
                    <h3 style="margin-bottom: 16px;">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <p>–°—Ç—Ä–∏–∫ üî•</p>
                            <p>${streak} –¥–Ω–µ–π</p>
                        </div>
                        <div class="stat-item">
                            <p>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                            <p>${workouts.length}</p>
                        </div>
                        <div class="stat-item">
                            <p>–ü–æ–¥—Ö–æ–¥–æ–≤</p>
                            <p>${totalSets}</p>
                        </div>
                        <div class="stat-item">
                            <p>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>
                            <p>${exercises.length}</p>
                        </div>
                    </div>
                </div>
            `;

            if (workouts.length === 0) {
                html += '<div class="empty-state"><div style="font-size: 48px;">üìä</div><p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p><p style="font-size: 14px; margin-top: 8px;">–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p></div>';
            } else {
                // –ì—Ä–∞—Ñ–∏–∫ 7 –¥–Ω–µ–π
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
                        <canvas id="weeklyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; text-align: center; font-size: 16px; font-weight: 600; color: ${weeklyProg.isPositive ? '#10b981' : '#ef4444'}">
                            ${weeklyProg.isPositive ? '‚Üë' : '‚Üì'} ${weeklyProg.isPositive ? '+' : ''}${weeklyProg.diff} –ø–æ–≤—Ç. (${weeklyProg.isPositive ? '+' : ''}${weeklyProg.percent}%)
                            <div style="font-size: 13px; color: #666; font-weight: normal; margin-top: 4px;">vs –ø—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è</div>
                        </div>
                    </div>
                `;

                // –ì—Ä–∞—Ñ–∏–∫ 30 –¥–Ω–µ–π
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h3>
                        <canvas id="monthlyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; text-align: center; font-size: 16px; font-weight: 600; color: ${monthlyProg.isPositive ? '#10b981' : '#ef4444'}">
                            ${monthlyProg.isPositive ? '‚Üë' : '‚Üì'} ${monthlyProg.isPositive ? '+' : ''}${monthlyProg.diff} –ø–æ–≤—Ç. (${monthlyProg.isPositive ? '+' : ''}${monthlyProg.percent}%)
                            <div style="font-size: 13px; color: #666; font-weight: normal; margin-top: 4px;">vs –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</div>
                        </div>
                    </div>
                `;

                // –ì—Ä–∞—Ñ–∏–∫ 12 –º–µ—Å—è—Ü–µ–≤
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤</h3>
                        <canvas id="yearlyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; text-align: center; font-size: 16px; font-weight: 600; color: ${yearlyProg.isPositive ? '#10b981' : '#ef4444'}">
                            ${yearlyProg.isPositive ? '‚Üë' : '‚Üì'} ${yearlyProg.isPositive ? '+' : ''}${yearlyProg.diff} –ø–æ–≤—Ç. (${yearlyProg.isPositive ? '+' : ''}${yearlyProg.percent}%)
                            <div style="font-size: 13px; color: #666; font-weight: normal; margin-top: 4px;">–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å. vs –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 6 –º–µ—Å.</div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('statsView').innerHTML = html;

            // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
            if (workouts.length > 0) {
                setTimeout(() => {
                    drawBarChart('weeklyChart', weeklyData, '#3b82f6');
                    drawLineChart('monthlyChart', monthlyData, '#8b5cf6');
                    drawBarChart('yearlyChart', yearlyData, '#10b981');
                }, 100);
            }
        }

        // –†–æ—É—Ç–µ—Ä –≤–∏–¥–æ–≤
        function renderView(viewName) {
            switch(viewName) {
                case 'home': renderHome(); break;
                case 'exercises': renderExercises(); break;
                case 'newWorkout': renderNewWorkout(); break;
                case 'calendar': renderCalendar(); break;
                case 'stats': renderStats(); break;
                case 'exerciseProgress': renderExerciseProgress(); break;
                case 'exerciseDetail': renderExerciseDetail(); break;
                case 'settings': renderSettings(); break;
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        function renderSettings() {
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <div style="width: 60px;"></div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 12px;">–î–∞–Ω–Ω—ã–µ</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                        –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: ${exercises.length}<br>
                        –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: ${workouts.length}<br>
                        –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö: ~${Math.round((JSON.stringify(exercises).length + JSON.stringify(workouts).length) / 1024)} –ö–ë
                    </p>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 8px; color: #ef4444;">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 16px;">
                        –≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
                    </p>
                    
                    <button onclick="resetWorkouts()" style="width: 100%; padding: 12px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; margin-bottom: 8px; cursor: pointer;">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                    </button>
                    
                    <button onclick="resetExercises()" style="width: 100%; padding: 12px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; margin-bottom: 8px; cursor: pointer;">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
                    </button>
                    
                    <button onclick="resetAll()" style="width: 100%; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                        ‚ö†Ô∏è –°–ë–†–û–°–ò–¢–¨ –í–°–Å
                    </button>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 12px;">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                    <p style="color: #666; font-size: 14px;">
                        üí™ –¢—Ä–µ–∫–µ—Ä –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ v1.0<br>
                        –°–æ–∑–¥–∞–Ω–æ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö<br><br>
                        –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
                    </p>
                </div>
            `;

            document.getElementById('settingsView').innerHTML = html;
        }

        function resetWorkouts() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                workouts = [];
                saveWorkouts();
                alert('‚úÖ –í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É–¥–∞–ª–µ–Ω—ã');
                renderSettings();
            }
        }

        function resetExercises() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è? –≠—Ç–æ —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!')) {
                exercises = [];
                workouts = [];
                saveExercises();
                saveWorkouts();
                alert('‚úÖ –í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É–¥–∞–ª–µ–Ω—ã');
                renderSettings();
            }
        }

        function resetAll() {
            if (confirm('‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç:\n‚Ä¢ –í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è\n‚Ä¢ –í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n‚Ä¢ –í—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã –Ω–∞ 100%? –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ!')) {
                    exercises = [];
                    workouts = [];
                    currentWorkout = [];
                    localStorage.clear();
                    alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ.');
                    showView('home');
                }
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
        function getExerciseStats(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            const type = exercise ? exercise.type : 'reps';
            
            const exerciseWorkouts = workouts.filter(w => 
                w.exercises.some(e => e.exerciseId === exerciseId)
            );

            const totalWorkouts = exerciseWorkouts.length;
            let totalSets = 0;
            let totalReps = 0;
            let totalWeight = 0;
            let maxReps = 0;
            let maxWeight = 0;

            exerciseWorkouts.forEach(w => {
                const ex = w.exercises.find(e => e.exerciseId === exerciseId);
                if (ex) {
                    totalSets += ex.sets.length;
                    ex.sets.forEach(set => {
                        totalReps += set.reps;
                        if (type === 'weight') {
                            totalWeight += (set.weight || 0) * set.reps;
                            if ((set.weight || 0) > maxWeight) maxWeight = set.weight || 0;
                        }
                        if (set.reps > maxReps) maxReps = set.reps;
                    });
                }
            });

            return { 
                totalWorkouts, 
                totalSets, 
                totalReps, 
                totalWeight,
                maxReps, 
                maxWeight,
                avgReps: totalWorkouts ? Math.round(totalReps / totalWorkouts) : 0 
            };
        }

        function getExerciseWeeklyData(exerciseId) {
            const today = new Date();
            const stats = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                const workout = workouts.find(w => w.date === dateStr);
                
                let reps = 0;
                let sets = 0;
                if (workout) {
                    const ex = workout.exercises.find(e => e.exerciseId === exerciseId);
                    if (ex) {
                        sets = ex.sets.length;
                        reps = ex.sets.reduce((s, set) => s + set.reps, 0);
                    }
                }

                stats.push({
                    day: date.toLocaleDateString('ru-RU', { weekday: 'short' }),
                    reps,
                    sets
                });
            }
            return stats;
        }

        function getExerciseMonthlyData(exerciseId) {
            const today = new Date();
            const stats = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                const workout = workouts.find(w => w.date === dateStr);
                
                let reps = 0;
                if (workout) {
                    const ex = workout.exercises.find(e => e.exerciseId === exerciseId);
                    if (ex) {
                        reps = ex.sets.reduce((s, set) => s + set.reps, 0);
                    }
                }

                stats.push({ date: date.getDate(), reps });
            }
            return stats;
        }

        function getExerciseYearlyData(exerciseId) {
            const today = new Date();
            const stats = [];
            
            for (let i = 11; i >= 0; i--) {
                const monthDate = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthStart = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
                const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
                
                const monthWorkouts = workouts.filter(w => {
                    const date = new Date(w.date);
                    return date >= monthStart && date <= monthEnd;
                });

                let reps = 0;
                let sets = 0;
                monthWorkouts.forEach(w => {
                    const ex = w.exercises.find(e => e.exerciseId === exerciseId);
                    if (ex) {
                        sets += ex.sets.length;
                        reps += ex.sets.reduce((s, set) => s + set.reps, 0);
                    }
                });

                stats.push({
                    month: monthDate.toLocaleDateString('ru-RU', { month: 'short' }),
                    reps,
                    sets
                });
            }
            return stats;
        }

        // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
        function renderExerciseProgress() {
            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h2>
                    <div style="width: 60px;"></div>
                </div>
            `;

            if (exercises.length === 0) {
                html += '<div class="empty-state"><div style="font-size: 48px;">üèãÔ∏è</div><p>–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p><p style="font-size: 14px; margin-top: 8px;">–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</p></div>';
            } else {
                exercises.forEach(ex => {
                    const stats = getExerciseStats(ex.id);
                    html += `
                        <div class="card" onclick="viewExerciseDetail('${ex.id}')" style="cursor: pointer;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h3 style="margin: 0;">${ex.name}</h3>
                                <span style="font-size: 20px;">‚Üí</span>
                            </div>
                            <div class="stat-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                <div>
                                    <p style="font-size: 12px; color: #666;">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                                    <p style="font-size: 20px; font-weight: bold;">${stats.totalWorkouts}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #666;">–ü–æ–¥—Ö–æ–¥–æ–≤</p>
                                    <p style="font-size: 20px; font-weight: bold;">${stats.totalSets}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #666;">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</p>
                                    <p style="font-size: 20px; font-weight: bold;">${stats.totalReps}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #666;">–ú–∞–∫—Å</p>
                                    <p style="font-size: 20px; font-weight: bold;">${stats.maxReps}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            document.getElementById('exerciseProgressView').innerHTML = html;
        }

        // –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        let selectedExerciseId = null;

        function viewExerciseDetail(exerciseId) {
            selectedExerciseId = exerciseId;
            showView('exerciseDetail');
        }

        function renderExerciseDetail() {
            if (!selectedExerciseId) return;

            const exercise = exercises.find(e => e.id === selectedExerciseId);
            if (!exercise) return;

            const type = exercise.type || 'reps';
            const stats = getExerciseStats(selectedExerciseId);
            const weeklyData = getExerciseWeeklyData(selectedExerciseId);
            const monthlyData = getExerciseMonthlyData(selectedExerciseId);
            const yearlyData = getExerciseYearlyData(selectedExerciseId);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
            let unitLabel = '';
            let unitShort = '';
            if (type === 'distance') {
                unitLabel = '–ö–∏–ª–æ–º–µ—Ç—Ä—ã';
                unitShort = '–∫–º';
            } else if (type === 'time') {
                unitLabel = '–ú–∏–Ω—É—Ç—ã';
                unitShort = '–º–∏–Ω';
            } else if (type === 'weight') {
                unitLabel = '–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è';
                unitShort = '–ø–æ–≤—Ç';
            } else {
                unitLabel = '–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è';
                unitShort = '–ø–æ–≤—Ç';
            }

            let html = `
                <div class="top-bar">
                    <button class="back-btn" onclick="showView('exerciseProgress')">‚Üê –ù–∞–∑–∞–¥</button>
                    <h2 style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${exercise.name}</h2>
                    <div style="width: 60px;"></div>
                </div>

                <div class="header-card">
                    <h3 style="margin-bottom: 16px;">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stat-grid">
                        <div class="stat-item">
                            <p>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                            <p>${stats.totalWorkouts}</p>
                        </div>
                        <div class="stat-item">
                            <p>–ü–æ–¥—Ö–æ–¥–æ–≤</p>
                            <p>${stats.totalSets}</p>
                        </div>`;

            if (type === 'weight') {
                html += `<div class="stat-item">
                            <p>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</p>
                            <p>${stats.totalReps}</p>
                        </div>
                        <div class="stat-item">
                            <p>–û–±—â–∏–π –≤–µ—Å</p>
                            <p>${Math.round(stats.totalWeight)} –∫–≥</p>
                        </div>`;
            } else if (type === 'distance') {
                html += `<div class="stat-item">
                            <p>–í—Å–µ–≥–æ –∫–º</p>
                            <p>${stats.totalReps.toFixed(1)}</p>
                        </div>
                        <div class="stat-item">
                            <p>–ú–∞–∫—Å –∑–∞ –ø–æ–¥—Ö–æ–¥</p>
                            <p>${stats.maxReps.toFixed(1)} –∫–º</p>
                        </div>`;
            } else if (type === 'time') {
                html += `<div class="stat-item">
                            <p>–í—Å–µ–≥–æ –º–∏–Ω—É—Ç</p>
                            <p>${Math.round(stats.totalReps)}</p>
                        </div>
                        <div class="stat-item">
                            <p>–ú–∞–∫—Å –∑–∞ –ø–æ–¥—Ö–æ–¥</p>
                            <p>${Math.round(stats.maxReps)} –º–∏–Ω</p>
                        </div>`;
            } else {
                html += `<div class="stat-item">
                            <p>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</p>
                            <p>${stats.totalReps}</p>
                        </div>
                        <div class="stat-item">
                            <p>–ú–∞–∫—Å –∑–∞ –ø–æ–¥—Ö–æ–¥</p>
                            <p>${stats.maxReps}</p>
                        </div>`;
            }

            html += `</div></div>`;

            if (stats.totalWorkouts === 0) {
                html += '<div class="empty-state"><div style="font-size: 48px;">üìä</div><p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —ç—Ç–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é</p></div>';
            } else {
                const weeklyTotal = weeklyData.reduce((s, d) => s + d.reps, 0);
                const weeklySets = weeklyData.reduce((s, d) => s + d.sets, 0);
                const monthlyTotal = monthlyData.reduce((s, d) => s + d.reps, 0);
                const yearlyTotal = yearlyData.reduce((s, d) => s + d.reps, 0);
                const yearlySets = yearlyData.reduce((s, d) => s + d.sets, 0);

                // –ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–µ–ª–∏
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h3>
                        <canvas id="exerciseWeeklyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center;">
                                <div>
                                    <p style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ ${unitLabel.toLowerCase()}</p>
                                    <p style="font-size: 18px; font-weight: bold; color: #3b82f6;">${type === 'distance' ? weeklyTotal.toFixed(1) : Math.round(weeklyTotal)} ${unitShort}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤</p>
                                    <p style="font-size: 18px; font-weight: bold; color: #3b82f6;">${weeklySets}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // –ì—Ä–∞—Ñ–∏–∫ –º–µ—Å—è—Ü–∞
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h3>
                        <canvas id="exerciseMonthlyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee; text-align: center;">
                            <p style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ ${unitLabel.toLowerCase()} –∑–∞ –º–µ—Å—è—Ü</p>
                            <p style="font-size: 24px; font-weight: bold; color: #8b5cf6;">${type === 'distance' ? monthlyTotal.toFixed(1) : Math.round(monthlyTotal)} ${unitShort}</p>
                        </div>
                    </div>
                `;

                // –ì—Ä–∞—Ñ–∏–∫ –≥–æ–¥–∞
                html += `
                    <div class="card">
                        <h3 style="margin-bottom: 12px;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 12 –º–µ—Å—è—Ü–µ–≤</h3>
                        <canvas id="exerciseYearlyChart" width="550" height="250" style="width: 100%; max-width: 550px;"></canvas>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: center;">
                                <div>
                                    <p style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ ${unitLabel.toLowerCase()}</p>
                                    <p style="font-size: 18px; font-weight: bold; color: #10b981;">${type === 'distance' ? yearlyTotal.toFixed(1) : Math.round(yearlyTotal)} ${unitShort}</p>
                                </div>
                                <div>
                                    <p style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤</p>
                                    <p style="font-size: 18px; font-weight: bold; color: #10b981;">${yearlySets}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('exerciseDetailView').innerHTML = html;

            if (stats.totalWorkouts > 0) {
                setTimeout(() => {
                    drawBarChart('exerciseWeeklyChart', weeklyData, '#3b82f6');
                    drawLineChart('exerciseMonthlyChart', monthlyData, '#8b5cf6');
                    drawBarChart('exerciseYearlyChart', yearlyData, '#10b981');
                }, 100);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        loadData();
        showView('home');
    </script>
</body>
</html>